<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="WHO, OMS">
    <title>WHO - IRAQ</title>

    <!-- Bootstrap core CSS -->
    <link href="code/src/bootstrap-3.3.4-dist/css/bootstrap.min.css" rel="stylesheet"> 
    <link rel="stylesheet" href="code/src/nvd3-master/build/nv.d3.min.css" />
    <link rel="stylesheet" href="code/css/style.css"/>

    <script src="code/src/jquery-2.1.1.min.js"></script>
    <script src="code/src/nvd3-master/d3.min.js"></script>
    <script src="code/src/nvd3-master/build/nv.d3.min.js"></script>   
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">WHO - IRAQ - EWARN</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <!-- <li class="active"><a href="#">Home</a></li> -->
            <li><a href="index.html"><span class="glyphicon glyphicon glyphicon-globe" aria-hidden="true"></span>  Maps</a></li>
            <li><a href="charts.html"><span class="glyphicon glyphicon glyphicon-signal" aria-hidden="true"></span>  Charts</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div class="epi_content">
    <script>
    $(document).ready(function() {
        d3.json("code/data/linebart_chart.json",function(error,data) {
            nv.addGraph(function() {
              var chart = nv.models.linePlusBarChart()
                    .margin({top: 30, right: 60, bottom: 50, left: 70})
                    //We can set x data accessor to use index. Reason? So the bars all appear evenly spaced.
                    .x(function(d,i) { return i })
                    .y(function(d,i) {return d[1] })
                    .focusEnable(false) // Remove the focus chart bellow the main one
                    ;
                    
              // Custom the tooltip
              chart.tooltip.contentGenerator(function (key) {
                    //if the serie is the reporting sites
                    if(key.hasOwnProperty('point')){
                        etiquette = '<b>Week ' + key.point[0] + '</b><table><tr><td class="legend-color-guide"><div style="background:'+ key.point.color + ';"></div></td><td>' + key.point[1] + ' Reporting Sites</td></table>'
                    }
                    // the total consultations serie
                    else {
                        etiquette = '<b>Week ' + key.data[0] + '</b><table><tr><td class="legend-color-guide"><div style="background:'+ key.color + ';"></div></td><td>' + key.data[1].toLocaleString() + ' Total Consulations'
                    }        
                    return etiquette;
               });

              // Change the y fomain for the reporting site serie to start at 0 and not at ymin
              chart.yDomain([0, 62]);

              // To custom the x-axis label. 
              var days = [1, "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30"]
                chart.xAxis.tickValues([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29])
                .axisLabel("Weeks")
                .tickFormat(function(d){
                    return days[d]
                });

              chart.y1Axis
                  .tickFormat(d3.format(',f'));

              chart.y2Axis
                  .tickFormat(d3.format(',f'));

              chart.bars.forceY([0]);

              d3.select('#chart svg')
                .datum(data)
                .transition()
                .duration(0)
                .call(chart);

              nv.utils.windowResize(chart.update);
              return chart;
          });
    });
});
    </script>
    <h2>Total Consultations and Number of Reporting Sites by Week</h2>
    <div id="chart" style="width: 75%; height: 400px; margin: 0 auto;">
        <svg></svg>
    </div>
    </div> 
    <script src="code/src/bootstrap-3.3.4-dist/js/bootstrap.min.js"></script> 